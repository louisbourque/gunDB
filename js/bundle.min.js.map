{"version":3,"sources":["bundle.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","global","Gun","gun","this","is","opt","Util","Type","fns","fn","Function","bi","b","Boolean","num","list","Infinity","parseFloat","text","ify","JSON","stringify","toString","random","c","charAt","Math","floor","match","fuzzy","indexOf","=","obj","has","toLowerCase","slice","map","m","Array","slit","prototype","sort","k","A","B","_","index","constructor","Object","put","v","del","parse","copy","as","d","arguments","hasOwnProperty","empty","x","rr","ll","lle","ii","push","keys","time","Date","getTime","now","last","On","create","on","event","emit","args","hear","apply","splice","off","schedule","state","cb","waiting","when","soonest","set","future","clearTimeout","id","setTimeout","check","wait","version","meta","soul","field","#",".",">","val","rel","lex","node","force","reverse","graph","g","exist","HAM","machineState","incomingState","currentState","incomingValue","currentValue","defer","historical","converge","incoming","String","current","err","union","prime","at","ctx","__","count","log","vertex","value","change","merge","vert","delta","lower","upper","max","end","update","drift","tmp","root","console","proxy","hash","mem","all","chain","only","stat","first","stun","by","peers","wire","h","from","back","env","eat","path","done","wcb","ok","info","not","get","pure","init","halt","raw","no","load","cached","stream","data","ran","key","each","once","xtc","fat","split","via","ref","concat","kick","next","item","unique","queue","seen","loop","start","shift","it","join","was","to","w","window","Log","squelch","debug","bind","Tab","store","setItem","getItem","removeItem","storage","fail","uid","localStorage","exception","tab","request","headers","prefix","ropt","msg","local","error","reply","body","peer","url","chunk","write","clear","debounce","server","req","res","rid","json","regex","route","Content-Type","able","createServer","base","transport","ing","backoff","ws","jsonp","WS","WebSocket","mozWebSocket","webkitWebSocket","readyState","cbs","send","replace","onopen","onclose","close","onbeforeunload","onmessage","onerror","poll","js","document","createElement","src","parentNode","removeChild","async","getElementsByTagName","appendChild","pull","uri","encodeURIComponent","q","pathname","query","wls","self","2","_interopRequireDefault","__esModule","default","_gun","_gun2","textInput","getElementById","style","backgroundColor","updateMyInput","gun/gun"],"mappings":"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","file":"bundle.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n(function (global){\n;(function(){\n\t\n\tfunction Gun(o){\n\t\tvar gun = this;\n\t\tif(!Gun.is(gun)){ return new Gun(o) }\n\t\tif(Gun.is(o)){ return gun }\n\t\treturn gun.opt(o);\n\t}\n\t\n\t;(function(Util){ // Generic javascript utilities.\n\t\t;(function(Type){\n\t\t\tType.fns = {is: function(fn){ return (fn instanceof Function)? true : false }};\n\t\t\tType.bi = {is: function(b){ return (b instanceof Boolean || typeof b == 'boolean')? true : false }}\n\t\t\tType.num = {is: function(n){ return !Type.list.is(n) && (Infinity === n || n - parseFloat(n) + 1 >= 0) }}\n\t\t\tType.text = {is: function(t){ return typeof t == 'string'? true : false }}\n\t\t\tType.text.ify = function(t){\n\t\t\t\tif(Type.text.is(t)){ return t }\n\t\t\t\tif(typeof JSON !== \"undefined\"){ return JSON.stringify(t) }\n\t\t\t\treturn (t && t.toString)? t.toString() : t;\n\t\t\t}\n\t\t\tType.text.random = function(l, c){\n\t\t\t\tvar s = '';\n\t\t\t\tl = l || 24; // you are not going to make a 0 length random number, so no need to check type\n\t\t\t\tc = c || '0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz';\n\t\t\t\twhile(l > 0){ s += c.charAt(Math.floor(Math.random() * c.length)); l-- }\n\t\t\t\treturn s;\n\t\t\t}\n\t\t\tType.text.match = function(t, o){ var r = false;\n\t\t\t\tt = t || '';\n\t\t\t\to = Gun.text.is(o)? {'=': o} : o || {}; // {'~', '=', '*', '<', '>', '+', '-', '?', '!'} // ignore uppercase, exactly equal, anything after, lexically larger, lexically lesser, added in, subtacted from, questionable fuzzy match, and ends with.\n\t\t\t\tif(Type.obj.has(o,'~')){ t = t.toLowerCase() }\n\t\t\t\tif(Type.obj.has(o,'=')){ return t === o['='] }\n\t\t\t\tif(Type.obj.has(o,'*')){ if(t.slice(0, o['*'].length) === o['*']){ r = true; t = t.slice(o['*'].length) } else { return false }}\n\t\t\t\tif(Type.obj.has(o,'!')){ if(t.slice(-o['!'].length) === o['!']){ r = true } else { return false }}\n\t\t\t\tif(Type.obj.has(o,'+')){\n\t\t\t\t\tif(Type.list.map(Type.list.is(o['+'])? o['+'] : [o['+']], function(m){\n\t\t\t\t\t\tif(t.indexOf(m) >= 0){ r = true } else { return true }\n\t\t\t\t\t})){ return false }\n\t\t\t\t}\n\t\t\t\tif(Type.obj.has(o,'-')){\n\t\t\t\t\tif(Type.list.map(Type.list.is(o['-'])? o['-'] : [o['-']], function(m){\n\t\t\t\t\t\tif(t.indexOf(m) < 0){ r = true } else { return true }\n\t\t\t\t\t})){ return false }\n\t\t\t\t}\n\t\t\t\tif(Type.obj.has(o,'>')){ if(t > o['>']){ r = true } else { return false }}\n\t\t\t\tif(Type.obj.has(o,'<')){ if(t < o['<']){ r = true } else { return false }}\n\t\t\t\tfunction fuzzy(t,f){ var n = -1, i = 0, c; for(;c = f[i++];){ if(!~(n = t.indexOf(c, n+1))){ return false }} return true } // via http://stackoverflow.com/questions/9206013/javascript-fuzzy-search\n\t\t\t\tif(Type.obj.has(o,'?')){ if(fuzzy(t, o['?'])){ r = true } else { return false }} // change name!\n\t\t\t\treturn r;\n\t\t\t}\n\t\t\tType.list = {is: function(l){ return (l instanceof Array)? true : false }}\n\t\t\tType.list.slit = Array.prototype.slice;\n\t\t\tType.list.sort = function(k){ // creates a new sort function based off some field\n\t\t\t\treturn function(A,B){\n\t\t\t\t\tif(!A || !B){ return 0 } A = A[k]; B = B[k];\n\t\t\t\t\tif(A < B){ return -1 }else if(A > B){ return 1 }\n\t\t\t\t\telse { return 0 }\n\t\t\t\t}\n\t\t\t}\n\t\t\tType.list.map = function(l, c, _){ return Type.obj.map(l, c, _) }\n\t\t\tType.list.index = 1; // change this to 0 if you want non-logical, non-mathematical, non-matrix, non-convenient array notation\n\t\t\tType.obj = {is: function(o) { return !o || !o.constructor? false : o.constructor === Object? true : !o.constructor.call || o.constructor.toString().match(/\\[native\\ code\\]/)? false : true }}\n\t\t\tType.obj.put = function(o, f, v){ return (o||{})[f] = v, o } \n\t\t\tType.obj.del = function(o, k){\n\t\t\t\tif(!o){ return }\n\t\t\t\to[k] = null;\n\t\t\t\tdelete o[k];\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tType.obj.ify = function(o){\n\t\t\t\tif(Type.obj.is(o)){ return o }\n\t\t\t\ttry{o = JSON.parse(o);\n\t\t\t\t}catch(e){o={}};\n\t\t\t\treturn o;\n\t\t\t}\n\t\t\tType.obj.copy = function(o){ // because http://web.archive.org/web/20140328224025/http://jsperf.com/cloning-an-object/2\n\t\t\t\treturn !o? o : JSON.parse(JSON.stringify(o)); // is shockingly faster than anything else, and our data has to be a subset of JSON anyways!\n\t\t\t}\n\t\t\tType.obj.as = function(b, f, d){ return b[f] = b[f] || (arguments.length >= 3? d : {}) }\n\t\t\tType.obj.has = function(o, t){ return o && Object.prototype.hasOwnProperty.call(o, t) }\n\t\t\tType.obj.empty = function(o, n){\n\t\t\t\tif(!o){ return true }\n\t\t\t\treturn Type.obj.map(o,function(v,i){\n\t\t\t\t\tif(n && (i === n || (Type.obj.is(n) && Type.obj.has(n, i)))){ return }\n\t\t\t\t\tif(i){ return true }\n\t\t\t\t})? false : true;\n\t\t\t}\n\t\t\tType.obj.map = function(l, c, _){\n\t\t\t\tvar u, i = 0, ii = 0, x, r, rr, ll, lle, f = Type.fns.is(c),\n\t\t\t\tt = function(k,v){\n\t\t\t\t\tif(2 === arguments.length){\n\t\t\t\t\t\trr = rr || {};\n\t\t\t\t\t\trr[k] = v;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} rr = rr || [];\n\t\t\t\t\trr.push(k);\n\t\t\t\t};\n\t\t\t\tif(Object.keys && Type.obj.is(l)){\n\t\t\t\t\tll = Object.keys(l); lle = true;\n\t\t\t\t}\n\t\t\t\tif(Type.list.is(l) || ll){\n\t\t\t\t\tx = (ll || l).length;\n\t\t\t\t\tfor(;i < x; i++){\n\t\t\t\t\t\tii = (i + Type.list.index);\n\t\t\t\t\t\tif(f){\n\t\t\t\t\t\t\tr = lle? c.call(_ || this, l[ll[i]], ll[i], t) : c.call(_ || this, l[i], ii, t);\n\t\t\t\t\t\t\tif(r !== u){ return r }\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//if(Type.test.is(c,l[i])){ return ii } // should implement deep equality testing!\n\t\t\t\t\t\t\tif(c === l[lle? ll[i] : i]){ return ll? ll[i] : ii } // use this for now\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tfor(i in l){\n\t\t\t\t\t\tif(f){\n\t\t\t\t\t\t\tif(Type.obj.has(l,i)){\n\t\t\t\t\t\t\t\tr = _? c.call(_, l[i], i, t) : c(l[i], i, t);\n\t\t\t\t\t\t\t\tif(r !== u){ return r }\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//if(a.test.is(c,l[i])){ return i } // should implement deep equality testing!\n\t\t\t\t\t\t\tif(c === l[i]){ return i } // use this for now\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn f? rr : Type.list.index? 0 : -1;\n\t\t\t}\n\t\t\tType.time = {};\n\t\t\tType.time.is = function(t){ return t? t instanceof Date : (+new Date().getTime()) }\n\t\t\tType.time.now = (function(){\n\t\t\t    var time = Type.time.is, last = -Infinity, n = 0, d = 1000;\n\t\t\t    return function(){\n\t\t\t        var t = time();\n\t\t\t        if(last < t){\n\t\t\t            n = 0;\n\t\t\t            return last = t;\n\t\t\t        }\n\t\t\t        return last = t + ((n += 1) / d);\n\t\t\t    }\n\t\t\t}());\n\t\t}(Util));\n\t\t;(function(exports){ // On event emitter generic javascript utility.\n\t\t\tfunction On(){};\n\t\t\tOn.create = function(){\n\t\t\t\tvar on = function(e){\n\t\t\t\t\ton.event.e = e;\n\t\t\t\t\ton.event.s[e] = on.event.s[e] || [];\n\t\t\t\t\treturn on;\n\t\t\t\t};\n\t\t\t\ton.emit = function(a){\n\t\t\t\t\tvar e = on.event.e, s = on.event.s[e], args = arguments, l = args.length;\n\t\t\t\t\texports.list.map(s, function(hear, i){\n\t\t\t\t\t\tif(!hear.fn){ s.splice(i-1, 0); return; }\n\t\t\t\t\t\tif(1 === l){ hear.fn(a); return; }\n\t\t\t\t\t\thear.fn.apply(hear, args);\n\t\t\t\t\t});\n\t\t\t\t\tif(!s.length){ delete on.event.s[e] }\n\t\t\t\t}\n\t\t\t\ton.event = function(fn, i){\n\t\t\t\t\tvar s = on.event.s[on.event.e]; if(!s){ return }\n\t\t\t\t\tvar e = {fn: fn, i: i || 0, off: function(){ return !(e.fn = false) }};\n\t\t\t\t\treturn s.push(e), i? s.sort(sort) : i, e;\n\t\t\t\t}\n\t\t\t\ton.event.s = {};\n\t\t\t\treturn on;\n\t\t\t}\n\t\t\tvar sort = exports.list.sort('i');\n\t\t\texports.on = On.create();\n\t\t\texports.on.create = On.create;\n\t\t}(Util));\n\t\t;(function(exports){ // Generic javascript scheduler utility.\n\t\t\tvar schedule = function(state, cb){ // maybe use lru-cache?\n\t\t\t\tschedule.waiting.push({when: state, event: cb || function(){}});\n\t\t\t\tif(schedule.soonest < state){ return }\n\t\t\t\tschedule.set(state);\n\t\t\t}\n\t\t\tschedule.waiting = [];\n\t\t\tschedule.soonest = Infinity;\n\t\t\tschedule.sort = exports.list.sort('when');\n\t\t\tschedule.set = function(future){\n\t\t\t\tif(Infinity <= (schedule.soonest = future)){ return }\n\t\t\t\tvar now = exports.time.now(); // WAS time.is() TODO: Hmmm, this would make it hard for every gun instance to have their own version of time.\n\t\t\t\tfuture = (future <= now)? 0 : (future - now);\n\t\t\t\tclearTimeout(schedule.id);\n\t\t\t\tschedule.id = setTimeout(schedule.check, future);\n\t\t\t}\n\t\t\tschedule.check = function(){\n\t\t\t\tvar now = exports.time.now(), soonest = Infinity; // WAS time.is() TODO: Same as above about time. Hmmm.\n\t\t\t\tschedule.waiting.sort(schedule.sort);\n\t\t\t\tschedule.waiting = exports.list.map(schedule.waiting, function(wait, i, map){\n\t\t\t\t\tif(!wait){ return }\n\t\t\t\t\tif(wait.when <= now){\n\t\t\t\t\t\tif(exports.fns.is(wait.event)){\n\t\t\t\t\t\t\tsetTimeout(function(){ wait.event() },0);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tsoonest = (soonest < wait.when)? soonest : wait.when;\n\t\t\t\t\t\tmap(wait);\n\t\t\t\t\t}\n\t\t\t\t}) || [];\n\t\t\t\tschedule.set(soonest);\n\t\t\t}\n\t\t\texports.schedule = schedule;\n\t\t}(Util));\n\t}(Gun));\n\n\t;(function(Gun){ // Gun specific utilities.\n\t\t\n\t\tGun.version = 0.3;\n\t\t\n\t\tGun._ = { // some reserved key words, these are not the only ones.\n\t\t\tmeta: '_' // all metadata of the node is stored in the meta property on the node.\n\t\t\t,soul: '#' // a soul is a UUID of a node but it always points to the \"latest\" data known.\n\t\t\t,field: '.' // a field is a property on a node which points to a value.\n\t\t\t,state: '>' // other than the soul, we store HAM metadata.\n\t\t\t,'#':'soul'\n\t\t\t,'.':'field'\n\t\t\t,'=':'value'\n\t\t\t,'>':'state'\n\t\t}\n\t\t\n\t\tGun.is = function(gun){ return (gun instanceof Gun)? true : false } // check to see if it is a GUN instance.\n\t\t\n\t\tGun.is.val = function(v){ // Valid values are a subset of JSON: null, binary, number (!Infinity), text, or a soul relation. Arrays need special algorithms to handle concurrency, so they are not supported directly. Use an extension that supports them if needed but research their problems first.\n\t\t\tif(v === null){ return true } // \"deletes\", nulling out fields.\n\t\t\tif(v === Infinity){ return false } // we want this to be, but JSON does not support it, sad face.\n\t\t\tif(Gun.bi.is(v) // by \"binary\" we mean boolean.\n\t\t\t|| Gun.num.is(v)\n\t\t\t|| Gun.text.is(v)){ // by \"text\" we mean strings.\n\t\t\t\treturn true; // simple values are valid.\n\t\t\t}\n\t\t\treturn Gun.is.rel(v) || false; // is the value a soul relation? Then it is valid and return it. If not, everything else remaining is an invalid data type. Custom extensions can be built on top of these primitives to support other types.\n\t\t}\n\t\t\n\t\tGun.is.rel = function(v){ // this defines whether an object is a soul relation or not, they look like this: {'#': 'UUID'}\n\t\t\tif(Gun.obj.is(v)){ // must be an object.\n\t\t\t\tvar id;\n\t\t\t\tGun.obj.map(v, function(s, f){ // map over the object...\n\t\t\t\t\tif(id){ return id = false } // if ID is already defined AND we're still looping through the object, it is considered invalid.\n\t\t\t\t\tif(f == Gun._.soul && Gun.text.is(s)){ // the field should be '#' and have a text value.\n\t\t\t\t\t\tid = s; // we found the soul!\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn id = false; // if there exists anything else on the object that isn't the soul, then it is considered invalid.\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif(id){ // a valid id was found.\n\t\t\t\t\treturn id; // yay! Return it.\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false; // the value was not a valid soul relation.\n\t\t}\n\n\t\tGun.is.rel.ify = function(s){ var r = {}; return Gun.obj.put(r, Gun._.soul, s), r } // convert a soul into a relation and return it.\n\n\t\tGun.is.lex = function(l){ var r = true;\n\t\t\tif(!Gun.obj.is(l)){ return false }\n\t\t\tGun.obj.map(l, function(v,f){\n\t\t\t\tif(!Gun.obj.has(Gun._,f) || !(Gun.text.is(v) || Gun.obj.is(v))){ return r = false }\n\t\t\t}); // TODO: What if the lex cursor has a document on the match, that shouldn't be allowed!\n\t\t\treturn r;\n\t\t}\n\t\t\n\t\tGun.is.node = function(n, cb, t){ var s; // checks to see if an object is a valid node.\n\t\t\tif(!Gun.obj.is(n)){ return false } // must be an object.\n\t\t\tif(s = Gun.is.node.soul(n)){ // must have a soul on it.\n\t\t\t\treturn !Gun.obj.map(n, function(v, f){ // we invert this because the way we check for this is via a negation.\n\t\t\t\t\tif(f == Gun._.meta){ return } // skip over the metadata.\n\t\t\t\t\tif(!Gun.is.val(v)){ return true } // it is true that this is an invalid node.\n\t\t\t\t\tif(cb){ cb.call(t, v, f, n) } // optionally callback each field/value.\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn false; // nope! This was not a valid node.\n\t\t}\n\n\t\tGun.is.node.ify = function(n, s, o){ // convert a shallow object into a node.\n\t\t\to = Gun.bi.is(o)? {force: o} : o || {}; // detect options.\n\t\t\tn = Gun.is.node.soul.ify(n, s, o.force); // put a soul on it.\n\t\t\tGun.obj.map(n, function(v, f){ // iterate over each field/value.\n\t\t\t\tif(Gun._.meta === f){ return } // ignore meta.\n\t\t\t\tGun.is.node.state.ify([n], f, v, o.state = o.state || Gun.time.now()); // and set the state for this field and value on this node.\n\t\t\t});\n\t\t\treturn n; // This will only be a valid node if the object wasn't already deep!\n\t\t}\n\t\t\n\t\tGun.is.node.soul = function(n, s){ return (n && n._ && n._[s || Gun._.soul]) || false } // convenience function to check to see if there is a soul on a node and return it.\n\n\t\tGun.is.node.soul.ify = function(n, s, o){ // put a soul on an object.\n\t\t\tn = n || {}; // make sure it exists.\n\t\t\tn._ = n._ || {}; // make sure meta exists.\n\t\t\tn._[Gun._.soul] = o? s : n._[Gun._.soul] || s || Gun.text.random(); // if it already has a soul then use that instead - unless you force the soul you want with an option.\n\t\t\treturn n;\n\t\t}\n\n\t\tGun.is.node.state = function(n, f){ return (f && n && n._ && n._[Gun._.state] && Gun.num.is(n._[Gun._.state][f]))? n._[Gun._.state][f] : false } // convenience function to get the state on a field on a node and return it.\n\n\t\tGun.is.node.state.ify = function(l, f, v, state){ // put a field's state and value on some nodes.\n\t\t\tl = Gun.list.is(l)? l : [l]; // handle a list of nodes or just one node.\n\t\t\tvar l = l.reverse(), d = l[0]; // we might want to inherit the state from the last node in the list.\n\t\t\tGun.list.map(l, function(n, i){ // iterate over each node.\n\t\t\t\tn = n || {}; // make sure it exists.\n\t\t\t\tif(Gun.is.val(v)){ n[f] = v } // if we have a value, then put it.\n\t\t\t\tn._ = n._ || {}; // make sure meta exists.\n\t\t\t\tn = n._[Gun._.state] = n._[Gun._.state] || {}; // make sure HAM state exists.\n\t\t\t\tif(i = d._[Gun._.state][f]){ n[f] = i } // inherit the state!\n\t\t\t\tif(Gun.num.is(state)){ n[f] = state } // or manually set the state.\n\t\t\t});\n\t\t}\n\t\t\n\t\tGun.is.graph = function(g, cb, fn, t){ // checks to see if an object is a valid graph.\n\t\t\tvar exist = false;\n\t\t\tif(!Gun.obj.is(g)){ return false } // must be an object.\n\t\t\treturn !Gun.obj.map(g, function(n, s){ // we invert this because the way we check for this is via a negation.\n\t\t\t\tif(!n || s !== Gun.is.node.soul(n) || !Gun.is.node(n, fn)){ return true } // it is true that this is an invalid graph.\t\t\t\t \n\t\t\t\t(cb || function(){}).call(t, n, s, function(fn){ // optional callback for each node.\n\t\t\t\t\tif(fn){ Gun.is.node(n, fn, t) } // where we then have an optional callback for each field/value.\n\t\t\t\t});\n\t\t\t\texist = true;\n\t\t\t}) && exist; // makes sure it wasn't an empty object.\n\t\t}\n\t\t\n\t\tGun.is.graph.ify = function(n){ var s; // wrap a node into a graph.\n\t\t\tif(s = Gun.is.node.soul(n)){ // grab the soul from the node, if it is a node.\n\t\t\t\treturn Gun.obj.put({}, s, n); // then create and return a graph which has a node on the matching soul property.\n\t\t\t}\n\t\t}\n\n\n\t\tGun.HAM = function(machineState, incomingState, currentState, incomingValue, currentValue){ // TODO: Lester's comments on roll backs could be vulnerable to divergence, investigate!\n\t\t\tif(machineState < incomingState){\n\t\t\t\t// the incoming value is outside the boundary of the machine's state, it must be reprocessed in another state.\n\t\t\t\treturn {defer: true};\n\t\t\t}\n\t\t\tif(incomingState < currentState){\n\t\t\t\t// the incoming value is within the boundary of the machine's state, but not within the range.\n\t\t\t\treturn {historical: true};\n\t\t\t}\n\t\t\tif(currentState < incomingState){\n\t\t\t\t// the incoming value is within both the boundary and the range of the machine's state.\n\t\t\t\treturn {converge: true, incoming: true};\n\t\t\t}\n\t\t\tif(incomingState === currentState){\n\t\t\t\tif(incomingValue === currentValue){ // Note: while these are practically the same, the deltas could be technically different\n\t\t\t\t\treturn {state: true};\n\t\t\t\t}\n\t\t\t\t/*\n\t\t\t\t\tThe following is a naive implementation, but will always work.\n\t\t\t\t\tNever change it unless you have specific needs that absolutely require it.\n\t\t\t\t\tIf changed, your data will diverge unless you guarantee every peer's algorithm has also been changed to be the same.\n\t\t\t\t\tAs a result, it is highly discouraged to modify despite the fact that it is naive,\n\t\t\t\t\tbecause convergence (data integrity) is generally more important.\n\t\t\t\t\tAny difference in this algorithm must be given a new and different name.\n\t\t\t\t*/\n\t\t\t\tif(String(incomingValue) < String(currentValue)){ // String only works on primitive values!\n\t\t\t\t\treturn {converge: true, current: true};\n\t\t\t\t}\n\t\t\t\tif(String(currentValue) < String(incomingValue)){ // String only works on primitive values!\n\t\t\t\t\treturn {converge: true, incoming: true};\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn {err: \"you have not properly handled recursion through your data or filtered it as JSON\"};\n\t\t}\n\t\t\n\t\tGun.union = function(gun, prime, cb, opt){ // merge two graphs into the first.\n\t\t\tvar opt = opt || Gun.obj.is(cb)? cb : {};\n\t\t\tvar ctx = {graph: gun.__.graph, count: 0};\n\t\t\tctx.cb = function(){\n\t\t\t\tcb = Gun.fns.is(cb)? cb() && null : null; \n\t\t\t}\n\t\t\tif(!ctx.graph){ ctx.err = {err: Gun.log(\"No graph!\") } }\n\t\t\tif(!prime){ ctx.err = {err: Gun.log(\"No data to merge!\") } }\n\t\t\tif(ctx.soul = Gun.is.node.soul(prime)){ prime = Gun.is.graph.ify(prime) }\n\t\t\tif(!Gun.is.graph(prime, null, function(val, field, node){ var meta;\n\t\t\t\tif(!Gun.num.is(Gun.is.node.state(node, field))){\n\t\t\t\t\treturn ctx.err = {err: Gun.log(\"No state on '\" + field + \"'!\") } \n\t\t\t\t}\n\t\t\t}) || ctx.err){ return ctx.err = ctx.err || {err: Gun.log(\"Invalid graph!\", prime)}, ctx }\n\t\t\tfunction emit(at){\n\t\t\t\tGun.on('operating').emit(gun, at);\n\t\t\t}\n\t\t\t(function union(graph, prime){\n\t\t\t\tvar prime = Gun.obj.map(prime, function(n,s,t){t(n)}).sort(function(A,B){\n\t\t\t\t\tvar s = Gun.is.node.soul(A);\n\t\t\t\t\tif(graph[s]){ return 1 }\n\t\t\t\t\treturn 0;\n\t\t\t\t});\n\t\t\t\tctx.count += 1;\n\t\t\t\tctx.err = Gun.list.map(prime, function(node, soul){\n\t\t\t\t\tsoul = Gun.is.node.soul(node);\n\t\t\t\t\tif(!soul){ return {err: Gun.log(\"Soul missing or mismatching!\")} }\n\t\t\t\t\tctx.count += 1;\n\t\t\t\t\tvar vertex = graph[soul];\n\t\t\t\t\tif(!vertex){ graph[soul] = vertex = Gun.is.node.ify({}, soul) }\n\t\t\t\t\tGun.union.HAM(vertex, node, function(vertex, field, val, state){\n\t\t\t\t\t\tGun.on('historical').emit(gun, {soul: soul, field: field, value: val, state: state, change: node});\n\t\t\t\t\t\tgun.__.on('historical').emit({soul: soul, field: field, change: node});\n\t\t\t\t\t}, function(vertex, field, val, state){\n\t\t\t\t\t\tif(!vertex){ return }\n\t\t\t\t\t\tvar change = Gun.is.node.soul.ify({}, soul);\n\t\t\t\t\t\tif(field){\n\t\t\t\t\t\t\tGun.is.node.state.ify([vertex, change, node], field, val);\n\t\t\t\t\t\t}\n\t\t\t\t\t\temit({soul: soul, field: field, value: val, state: state, change: change});\n\t\t\t\t\t}, function(vertex, field, val, state){\n\t\t\t\t\t\tGun.on('deferred').emit(gun, {soul: soul, field: field, value: val, state: state, change: node});\n\t\t\t\t\t})(function(){\n\t\t\t\t\t\temit({soul: soul, change: node});\n\t\t\t\t\t\tif(opt.soul){ opt.soul(soul) }\n\t\t\t\t\t\tif(!(ctx.count -= 1)){ ctx.cb() }\n\t\t\t\t\t}); // TODO: BUG? Handle error!\n\t\t\t\t});\n\t\t\t\tctx.count -= 1;\n\t\t\t})(ctx.graph, prime);\n\t\t\tif(!ctx.count){ ctx.cb() }\n\t\t\treturn ctx;\n\t\t}\n\t\t\n\t\tGun.union.ify = function(gun, prime, cb, opt){\n\t\t\tif(gun){ gun = (gun.__ && gun.__.graph)? gun.__.graph : gun }\n\t\t\tif(Gun.text.is(prime)){ \n\t\t\t\tif(gun && gun[prime]){\n\t\t\t\t\tprime = gun[prime];\n\t\t\t\t} else {\n\t\t\t\t\treturn Gun.is.node.ify({}, prime);\n\t\t\t\t}\n\t\t\t}\n\t\t\tvar vertex = Gun.is.node.soul.ify({}, Gun.is.node.soul(prime)), prime = Gun.is.graph.ify(prime) || prime;\n\t\t\tif(Gun.is.graph(prime, null, function(val, field){ var node;\n\t\t\t\tfunction merge(a, f, v){ Gun.is.node.state.ify(a, f, v) }\n\t\t\t\tif(Gun.is.rel(val)){ node = gun? gun[field] || prime[field] : prime[field] }\n\t\t\t\tGun.union.HAM(vertex, node, function(){}, function(vert, f, v){\n\t\t\t\t\tmerge([vertex, node], f, v);\n\t\t\t\t}, function(){})(function(err){\n\t\t\t\t\tif(err){ merge([vertex], field, val) }\n\t\t\t\t})\n\t\t\t})){ return vertex }\n\t\t}\n\t\t\n\t\tGun.union.HAM = function(vertex, delta, lower, now, upper){\n\t\t\tupper.max = -Infinity;\n\t\t\tnow.end = true;\n\t\t\tdelta = delta || {};\n\t\t\tvertex = vertex || {};\n\t\t\tGun.obj.map(delta._, function(v,f){\n\t\t\t\tif(Gun._.state === f || Gun._.soul === f){ return }\n\t\t\t\tvertex._[f] = v;\n\t\t\t});\n\t\t\tif(!Gun.is.node(delta, function update(incoming, field){\n\t\t\t\tnow.end = false;\n\t\t\t\tvar ctx = {incoming: {}, current: {}}, state;\n\t\t\t\tctx.drift = Gun.time.now(); // DANGEROUS!\n\t\t\t\tctx.incoming.value = Gun.is.rel(incoming) || incoming;\n\t\t\t\tctx.current.value = Gun.is.rel(vertex[field]) || vertex[field];\n\t\t\t\tctx.incoming.state = Gun.num.is(ctx.tmp = ((delta._||{})[Gun._.state]||{})[field])? ctx.tmp : -Infinity;\n\t\t\t\tctx.current.state = Gun.num.is(ctx.tmp = ((vertex._||{})[Gun._.state]||{})[field])? ctx.tmp : -Infinity;\n\t\t\t\tupper.max = ctx.incoming.state > upper.max? ctx.incoming.state : upper.max;\n\t\t\t\tstate = Gun.HAM(ctx.drift, ctx.incoming.state, ctx.current.state, ctx.incoming.value, ctx.current.value);\n\t\t\t\tif(state.err){\n\t\t\t\t\troot.console.log(\".!HYPOTHETICAL AMNESIA MACHINE ERR!.\", state.err); // this error should never happen.\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(state.state || state.historical || state.current){\n\t\t\t\t\tlower.call(state, vertex, field, incoming, ctx.incoming.state);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(state.incoming){\n\t\t\t\t\tnow.call(state, vertex, field, incoming, ctx.incoming.state);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(state.defer){\n\t\t\t\t\tupper.wait = true;\n\t\t\t\t\tupper.call(state, vertex, field, incoming, ctx.incoming.state); // signals that there are still future modifications.\n\t\t\t\t\tGun.schedule(ctx.incoming.state, function(){\n\t\t\t\t\t\tupdate(incoming, field);\n\t\t\t\t\t\tif(ctx.incoming.state === upper.max){ (upper.last || function(){})() }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})){ return function(fn){ if(fn){ fn({err: 'Not a node!'}) } } }\n\t\t\tif(now.end){ now.call({}, vertex) } // TODO: Should HAM handle empty updates? YES.\n\t\t\treturn function(fn){\n\t\t\t\tupper.last = fn || function(){};\n\t\t\t\tif(!upper.wait){ upper.last() }\n\t\t\t}\n\t\t}\n\n\t\tGun.on.at = function(on){ // On event emitter customized for gun.\n\t\t\tvar proxy = function(e){ return proxy.e = e, proxy }\n\t\t\tproxy.emit = function(at){\n\t\t\t\tif(at.soul){\n\t\t\t\t\tat.hash = Gun.on.at.hash(at);\n\t\t\t\t\t//Gun.obj.as(proxy.mem, proxy.e)[at.soul] = at; \n\t\t\t\t\tGun.obj.as(proxy.mem, proxy.e)[at.hash] = at;\n\t\t\t\t}\n\t\t\t\tif(proxy.all.cb){ proxy.all.cb(at, proxy.e) }\n\t\t\t\ton(proxy.e).emit(at);\n\t\t\t\treturn {chain: function(c){\n\t\t\t\t\tif(!c || !c._ || !c._.at){ return } \n\t\t\t\t\treturn c._.at(proxy.e).emit(at) \n\t\t\t\t}};\n\t\t\t}\n\t\t\tproxy.only = function(cb){\n\t\t\t\tif(proxy.only.cb){ return }\n\t\t\t\treturn proxy.event(proxy.only.cb = cb);\n\t\t\t}\n\t\t\tproxy.all = function(cb){\n\t\t\t\tproxy.all.cb = cb;\n\t\t\t\tGun.obj.map(proxy.mem, function(mem, e){\n\t\t\t\t\tGun.obj.map(mem, function(at, i){\n\t\t\t\t\t\tcb(at, e);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\tproxy.event = function(cb, i){\n\t\t\t\ti = on(proxy.e).event(cb, i);\n\t\t\t\treturn Gun.obj.map(proxy.mem[proxy.e], function(at){\n\t\t\t\t\ti.stat = {first: true};\n\t\t\t\t\tcb.call(i, at);\n\t\t\t\t}), i.stat = {}, i;\n\t\t\t}\n\t\t\tproxy.map = function(cb, i){\n\t\t\t\treturn proxy.event(cb, i);\n\t\t\t};\n\t\t\tproxy.mem = {};\n\t\t\treturn proxy;\n\t\t}\n\t\t\n\t\tGun.on.at.hash = function(at){ return (at.at && at.at.soul)? at.at.soul + (at.at.field || '') : at.soul + (at.field || '') }\n\n\t\tGun.on.at.copy = function(at){ return Gun.obj.del(at, 'hash'), Gun.obj.map(at, function(v,f,t){t(f,v)}) }\n\t\t\n\t}(Gun));\n\t\n\t;(function(Gun){ // Gun prototype chain methods.\n\t\n\t\tGun.chain = Gun.prototype;\n\n\t\tGun.chain.opt = function(opt, stun){\n\t\t\topt = opt || {};\n\t\t\tvar gun = this, root = (gun.__ && gun.__.gun)? gun.__.gun : (gun._ = gun.__ = {gun: gun}).gun.chain(); // if root does not exist, then create a root chain.\n\t\t\troot.__.by = root.__.by || function(f){ return gun.__.by[f] = gun.__.by[f] || {} };\n\t\t\troot.__.graph = root.__.graph || {};\n\t\t\troot.__.opt = root.__.opt || {peers: {}};\n\t\t\troot.__.opt.wire = root.__.opt.wire || {};\n\t\t\tif(Gun.text.is(opt)){ opt = {peers: opt} }\n\t\t\tif(Gun.list.is(opt)){ opt = {peers: opt} }\n\t\t\tif(Gun.text.is(opt.peers)){ opt.peers = [opt.peers] }\n\t\t\tif(Gun.list.is(opt.peers)){ opt.peers = Gun.obj.map(opt.peers, function(n,f,m){ m(n,{}) }) }\n\t\t\tGun.obj.map(opt.peers, function(v, f){\n\t\t\t\troot.__.opt.peers[f] = v;\n\t\t\t});\n\t\t\tGun.obj.map(opt.wire, function(h, f){\n\t\t\t\tif(!Gun.fns.is(h)){ return }\n\t\t\t\troot.__.opt.wire[f] = h;\n\t\t\t});\n\t\t\tGun.obj.map(['key', 'on', 'path', 'map', 'not', 'init'], function(f){\n\t\t\t\tif(!opt[f]){ return }\n\t\t\t\troot.__.opt[f] = opt[f] || root.__.opt[f];\n\t\t\t});\n\t\t\tif(!stun){ Gun.on('opt').emit(root, opt) }\n\t\t\treturn gun;\n\t\t}\n\n\t\tGun.chain.chain = function(s){\n\t\t\tvar from = this, gun = !from.back? from : new this.constructor(from);//Gun(from);\n\t\t\tgun._ = gun._ || {};\n\t\t\tgun._.back = gun.back || from;\n\t\t\tgun.back = gun.back || from;\n\t\t\tgun.__ = gun.__ || from.__;\n\t\t\tgun._.on = gun._.on || Gun.on.create();\n\t\t\tgun._.at = gun._.at || Gun.on.at(gun._.on);\n\t\t\treturn gun;\n\t\t}\n\n\t\tGun.chain.put = function(val, cb, opt){\n\t\t\topt = opt || {};\n\t\t\tcb = cb || function(){}; cb.hash = {};\n\t\t\tvar gun = this, chain = gun.chain(), tmp = {val: val}, drift = Gun.time.now();\n\t\t\tfunction put(at){\n\t\t\t\tvar val = tmp.val;\n\t\t\t\tvar ctx = {obj: val}; // prep the value for serialization\n\t\t\t\tctx.soul = at.field? at.soul : (at.at && at.at.soul) || at.soul; // figure out where we are\n\t\t\t\tctx.field = at.field? at.field : (at.at && at.at.field) || at.field; // did we come from some where?\n\t\t\t\tif(Gun.is(val)){\n\t\t\t\t\tif(!ctx.field){ return cb.call(chain, {err: ctx.err = Gun.log('No field to link node to!')}), chain._.at('err').emit(ctx.err) }\n\t\t\t\t\treturn val.val(function(node){\n\t\t\t\t\t\tvar soul = Gun.is.node.soul(node);\n\t\t\t\t\t\tif(!soul){ return cb.call(chain, {err: ctx.err = Gun.log('Only a node can be linked! Not \"' + node + '\"!')}), chain._.at('err').emit(ctx.err) }\n\t\t\t\t\t\ttmp.val = Gun.is.rel.ify(soul);\n\t\t\t\t\t\tput(at);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif(cb.hash[at.hash = at.hash || Gun.on.at.hash(at)]){ return } // if we have already seen this hash...\n\t\t\t\tcb.hash[at.hash] = true; // else mark that we're processing the data (failure to write could still occur).\n\t\t\t\tctx.by = chain.__.by(ctx.soul);\n\t\t\t\tctx.not = at.not || (at.at && at.at.not);\n\t\t\t\tGun.obj.del(at, 'not'); Gun.obj.del(at.at || at, 'not'); // the data is no longer not known! // TODO: BUG! It could have been asynchronous by the time we now delete these properties. Don't other parts of the code assume their deletion is synchronous?\n\t\t\t\tif(ctx.field){ Gun.obj.as(ctx.obj = {}, ctx.field, val) } // if there is a field, then data is actually getting put on the parent.\n\t\t\t\telse if(!Gun.obj.is(val)){ return cb.call(chain, ctx.err = {err: Gun.log(\"No node exists to put \" + (typeof val) + ' \"' + val + '\" in!')}), chain._.at('err').emit(ctx.err) } // if the data is a primitive and there is no context for it yet, then we have an error.\n\t\t\t\t// TODO: BUG? gun.get(key).path(field).put() isn't doing it as pseudo.\n\t\t\t\tfunction soul(env, cb, map){ var eat;\n\t\t\t\t\tif(!env || !(eat = env.at) || !env.at.node){ return }\n\t\t\t\t\tif(!eat.node._){ eat.node._ = {} }\n\t\t\t\t\tif(!eat.node._[Gun._.state]){ eat.node._[Gun._.state] = {} }\n\t\t\t\t\tif(!Gun.is.node.soul(eat.node)){\n\t\t\t\t\t\tif(ctx.obj === eat.obj){\n\t\t\t\t\t\t\tGun.obj.as(env.graph, eat.soul = Gun.obj.as(eat.node._, Gun._.soul, Gun.is.node.soul(eat.obj) || ctx.soul), eat.node);\n\t\t\t\t\t\t\tcb(eat, eat.soul);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tvar path = function(err, node){\n\t\t\t\t\t\t\t\tif(path.opt && path.opt.on && path.opt.on.off){ path.opt.on.off() }\n\t\t\t\t\t\t\t\tif(path.opt.done){ return }\n\t\t\t\t\t\t\t\tpath.opt.done = true;\n\t\t\t\t\t\t\t\tif(err){ env.err = err }\n\t\t\t\t\t\t\t\teat.soul = Gun.is.node.soul(node) || Gun.is.node.soul(eat.obj) || Gun.is.node.soul(eat.node) || Gun.text.random();\n\t\t\t\t\t\t\t\tGun.obj.as(env.graph, Gun.obj.as(eat.node._, Gun._.soul, eat.soul), eat.node);\n\t\t\t\t\t\t\t\tcb(eat, eat.soul);\n\t\t\t\t\t\t\t}; path.opt = {put: true};\n\t\t\t\t\t\t\t(ctx.not)? path() : ((at.field || at.at)? gun._.back : gun).path(eat.path || [], path, path.opt);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif(!eat.field){ return }\n\t\t\t\t\teat.node._[Gun._.state][eat.field] = drift;\n\t\t\t\t}\n\t\t\t\tfunction end(err, ify){\n\t\t\t\t\tctx.ify = ify;\n\t\t\t\t\tGun.on('put').emit(chain, at, ctx, opt, cb, val);\n\t\t\t\t\tif(err || ify.err){ return cb.call(chain, err || ify.err), chain._.at('err').emit(err || ify.err) } // check for serialization error, emit if so.\n\t\t\t\t\tif(err = Gun.union(chain, ify.graph, {end: false, soul: function(soul){\n\t\t\t\t\t\tif(chain.__.by(soul).end){ return }\n\t\t\t\t\t\tGun.union(chain, Gun.is.node.soul.ify({}, soul)); // fire off an end node if there hasn't already been one, to comply with the wire spec.\n\t\t\t\t\t}}).err){ return cb.call(chain, err), chain._.at('err').emit(err) } // now actually union the serialized data, emit error if any occur.\n\t\t\t\t\tif(Gun.fns.is(end.wire = chain.__.opt.wire.put)){\n\t\t\t\t\t\tvar wcb = function(err, ok, info){ \n\t\t\t\t\t\t\tif(err){ return Gun.log(err.err || err), cb.call(chain, err), chain._.at('err').emit(err) }\n\t\t\t\t\t\t\treturn cb.call(chain, err, ok);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tend.wire(ify.graph, wcb, opt);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif(!Gun.log.count('no-wire-put')){ Gun.log(\"Warning! You have no persistence layer to save to!\") }\n\t\t\t\t\t\tcb.call(chain, null); // This is in memory success, hardly \"success\" at all.\n\t\t\t\t\t}\n\t\t\t\t\tif(ctx.field){\n\t\t\t\t\t\treturn gun._.back.path(ctx.field, null, {chain: opt.chain || chain});\n\t\t\t\t\t}\n\t\t\t\t\tif(ctx.not){\n\t\t\t\t\t\treturn gun.__.gun.get(ctx.soul, null, {chain: opt.chain || chain});\n\t\t\t\t\t}\n\t\t\t\t\tchain.get(ctx.soul, null, {chain: opt.chain || chain, at: gun._.at })\n\t\t\t\t}\n\t\t\t\tGun.ify(ctx.obj, soul, {pure: true})(end); // serialize the data!\n\t\t\t}\n\t\t\tif(gun === gun.back){ // if we are the root chain...\n\t\t\t\tput({soul: Gun.is.node.soul(val) || Gun.text.random(), not: true}); // then cause the new chain to save data!\n\t\t\t} else { // else if we are on an existing chain then...\n\t\t\t\tgun._.at('soul').map(put); // put data on every soul that flows through this chain.\n\t\t\t\tvar back = function(gun){\n\t\t\t\t\tif(back.get || gun._.back === gun || gun._.not){ return } // TODO: CLEAN UP! Would be ideal to accomplish this in a more ideal way.\n\t\t\t\t\tif(gun._.get){ back.get = true }\n\t\t\t\t\tgun._.at('null').event(function(at){ this.off();\n\t\t\t\t\t\tif(opt.init || gun.__.opt.init){ return Gun.log(\"Warning! You have no context to `.put`\", val, \"!\") }\n\t\t\t\t\t\tgun.init();\n\t\t\t\t\t}, -999);\n\t\t\t\t\treturn back(gun._.back);\n\t\t\t\t};\n\t\t\t\tif(!opt.init && !gun.__.opt.init){ back(gun) }\n\t\t\t}\n\t\t\tchain.back = gun.back;\n\t\t\treturn chain;\n\t\t}\n\n\t\tGun.chain.get = (function(){\n\t\t\tGun.on('operating').event(function(gun, at){\n\t\t\t\tif(!gun.__.by(at.soul).node){ gun.__.by(at.soul).node = gun.__.graph[at.soul]  }\n\t\t\t\tif(at.field){ return } // TODO: It would be ideal to reuse HAM's field emit.\n\t\t\t\tgun.__.on(at.soul).emit(at);\n\t\t\t});\n\t\t\tGun.on('get').event(function(gun, at, ctx, opt, cb){\n\t\t\t\tif(ctx.halt){ return } // TODO: CLEAN UP with event emitter option?\n\t\t\t\tat.change = at.change || gun.__.by(at.soul).node;\n\t\t\t\tif(opt.raw){ return cb.call(opt.on, at) }\n\t\t\t\tif(!ctx.cb.no){ cb.call(ctx.by.chain, null, Gun.obj.copy(ctx.node || gun.__.by(at.soul).node)) }\n\t\t\t\tgun._.at('soul').emit(at).chain(opt.chain);\n\t\t\t},0);\n\t\t\tGun.on('get').event(function(gun, at, ctx){\n\t\t\t\tif(ctx.halt){ ctx.halt = false; return } // TODO: CLEAN UP with event emitter option?\n\t\t\t}, Infinity);\n\t\t\treturn function(lex, cb, opt){ // get opens up a reference to a node and loads it.\n\t\t\t\tvar gun = this, ctx = {\n\t\t\t\t\topt: opt || {},\n\t\t\t\t\tcb: cb || function(){},\n\t\t\t\t\tlex: (Gun.text.is(lex) || Gun.num.is(lex))? Gun.is.rel.ify(lex) : lex,\n\t\t\t\t};\n\t\t\t\tctx.force = ctx.opt.force;\n\t\t\t\tif(cb !== ctx.cb){ ctx.cb.no = true }\n\t\t\t\tif(!Gun.obj.is(ctx.lex)){ return ctx.cb.call(gun = gun.chain(), {err: Gun.log('Invalid get request!', lex)}), gun }\n\t\t\t\tif(!(ctx.soul = ctx.lex[Gun._.soul])){ return ctx.cb.call(gun = this.chain(), {err: Gun.log('No soul to get!')}), gun } // TODO: With `.all` it'll be okay to not have an exact match!\n\t\t\t\tctx.by = gun.__.by(ctx.soul);\n\t\t\t\tctx.by.chain = ctx.by.chain || gun.chain();\n\t\t\t\tfunction load(lex){\n\t\t\t\t\tvar soul = lex[Gun._.soul];\n\t\t\t\t\tvar cached = gun.__.by(soul).node || gun.__.graph[soul];\n\t\t\t\t\tif(ctx.force){ ctx.force = false }\n\t\t\t\t\telse if(cached){ return false }\n\t\t\t\t\twire(lex, stream, ctx.opt);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\tfunction stream(err, data, info){\n\t\t\t\t\t//console.log(\"wire.get <--\", err, data);\n\t\t\t\t\tGun.on('wire.get').emit(ctx.by.chain, ctx, err, data, info);\n\t\t\t\t\tif(err){\n\t\t\t\t\t\tGun.log(err.err || err);\n\t\t\t\t\t\tctx.cb.call(ctx.by.chain, err);\n\t\t\t\t\t\treturn ctx.by.chain._.at('err').emit({soul: ctx.soul, err: err.err || err}).chain(ctx.opt.chain);\n\t\t\t\t\t}\n\t\t\t\t\tif(!data){\n\t\t\t\t\t\tctx.cb.call(ctx.by.chain, null);\n\t\t\t\t\t\treturn ctx.by.chain._.at('null').emit({soul: ctx.soul, not: true}).chain(ctx.opt.chain);\n\t\t\t\t\t}\n\t\t\t\t\tif(Gun.obj.empty(data)){ return }\n\t\t\t\t\tif(err = Gun.union(ctx.by.chain, data).err){\n\t\t\t\t\t\tctx.cb.call(ctx.by.chain, err);\n\t\t\t\t\t\treturn ctx.by.chain._.at('err').emit({soul: Gun.is.node.soul(data) || ctx.soul, err: err.err || err}).chain(ctx.opt.chain);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfunction wire(lex, cb, opt){\n\t\t\t\t\tGun.on('get.wire').emit(ctx.by.chain, ctx, lex, cb, opt);\n\t\t\t\t\tif(Gun.fns.is(gun.__.opt.wire.get)){ return gun.__.opt.wire.get(lex, cb, opt) }\n\t\t\t\t\tif(!Gun.log.count('no-wire-get')){ Gun.log(\"Warning! You have no persistence layer to get from!\") }\n\t\t\t\t\tcb(null); // This is in memory success, hardly \"success\" at all.\n\t\t\t\t}\n\t\t\t\tfunction on(at){\n\t\t\t\t\tif(on.ran = true){ ctx.opt.on = this }\n\t\t\t\t\tif(load(ctx.lex)){ return }\n\t\t\t\t\tGun.on('get').emit(ctx.by.chain, at, ctx, ctx.opt, ctx.cb, ctx.lex);\n\t\t\t\t}\n\t\t\t\tctx.opt.on = (ctx.opt.at || gun.__.at)(ctx.soul).event(on);\n\t\t\t\tctx.by.chain._.get = ctx.lex;\n\t\t\t\tif(!ctx.opt.ran && !on.ran){ on.call(ctx.opt.on, {soul: ctx.soul}) }\n\t\t\t\treturn ctx.by.chain;\n\t\t\t}\n\t\t}());\n\n\t\tGun.chain.key = (function(){\n\t\t\tGun.on('put').event(function(gun, at, ctx, opt, cb){\n\t\t\t\tif(opt.key){ return }\n\t\t\t\tGun.is.graph(ctx.ify.graph, function(node, soul){\n\t\t\t\t\tvar key = {node: gun.__.graph[soul]};\n\t\t\t\t\tif(!Gun.is.node.soul(key.node, 'key')){ return }\n\t\t\t\t\tif(!gun.__.by(soul).end){ gun.__.by(soul).end = 1 }\n\t\t\t\t\tGun.is.node(key.node, function each(rel, s){\n\t\t\t\t\t\tvar n = gun.__.graph[s];\n\t\t\t\t\t\tif(n && Gun.is.node.soul(n, 'key')){\n\t\t\t\t\t\t\tGun.is.node(n, each);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\trel = ctx.ify.graph[s] = ctx.ify.graph[s] || Gun.is.node.soul.ify({}, s);\n\t\t\t\t\t\tGun.is.node(node, function(v,f){ Gun.is.node.state.ify([rel, node], f, v) });\n\t\t\t\t\t\tGun.obj.del(ctx.ify.graph, soul);\n\t\t\t\t\t})\n\t\t\t\t});\n\t\t\t});\n\t\t\tGun.on('get').event(function(gun, at, ctx, opt, cb){\n\t\t\t\tif(ctx.halt){ return } // TODO: CLEAN UP with event emitter option?\n\t\t\t\tif(opt.key && opt.key.soul){\n\t\t\t\t\tat.soul = opt.key.soul;\n\t\t\t\t\tgun.__.by(opt.key.soul).node = Gun.union.ify(gun, opt.key.soul); // TODO: Check performance?\n\t\t\t\t\tgun.__.by(opt.key.soul).node._['key'] = 'pseudo';\n\t\t\t\t\tat.change = Gun.is.node.soul.ify(Gun.obj.copy(at.change || gun.__.by(at.soul).node), at.soul, true); // TODO: Check performance?\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(!(Gun.is.node.soul(gun.__.graph[at.soul], 'key') === 1)){ return }\n\t\t\t\tvar node = at.change || gun.__.graph[at.soul];\n\t\t\t\tfunction map(rel, soul){ gun.__.gun.get(rel, cb, {key: ctx, chain: opt.chain || gun, force: opt.force}) }\n\t\t\t\tctx.halt = true;\n\t\t\t\tGun.is.node(node, map);\n\t\t\t},-999);\n\t\t\treturn function(key, cb, opt){\n\t\t\t\tvar gun = this;\n\t\t\t\topt = Gun.text.is(opt)? {soul: opt} : opt || {};\n\t\t\t\tcb = cb || function(){}; cb.hash = {};\n\t\t\t\tif(!Gun.text.is(key) || !key){ return cb.call(gun, {err: Gun.log('No key!')}), gun }\n\t\t\t\tfunction index(at){\n\t\t\t\t\tvar ctx = {node: gun.__.graph[at.soul]};\n\t\t\t\t\tif(at.soul === key || at.key === key){ return }\n\t\t\t\t\tif(cb.hash[at.hash = at.hash || Gun.on.at.hash(at)]){ return } cb.hash[at.hash] = true;\n\t\t\t\t\tctx.obj = (1 === Gun.is.node.soul(ctx.node, 'key'))? Gun.obj.copy(ctx.node) : Gun.obj.put({}, at.soul, Gun.is.rel.ify(at.soul));\n\t\t\t\t\tGun.obj.as((ctx.put = Gun.is.node.ify(ctx.obj, key, true))._, 'key', 1);\n\t\t\t\t\tgun.__.gun.put(ctx.put, function(err, ok){cb.call(this, err, ok)}, {chain: opt.chain, key: true, init: true});\n\t\t\t\t}\n\t\t\t\tif(opt.soul){\n\t\t\t\t\tindex({soul: opt.soul});\n\t\t\t\t\treturn gun;\n\t\t\t\t}\n\t\t\t\tif(gun === gun.back){\n\t\t\t\t\tcb.call(gun, {err: Gun.log('You have no context to `.key`', key, '!')});\n\t\t\t\t} else {\n\t\t\t\t\tgun._.at('soul').map(index);\n\t\t\t\t}\n\t\t\t\treturn gun;\n\t\t\t}\n\t\t}());\n\n\t\tGun.chain.on = function(cb, opt){ // on subscribes to any changes on the souls.\n\t\t\tvar gun = this, u;\n\t\t\topt = Gun.obj.is(opt)? opt : {change: opt};\n\t\t\tcb = cb || function(){};\n\t\t\tfunction map(at){\n\t\t\t\topt.on = opt.on || this;\n\t\t\t\tvar ctx = {by: gun.__.by(at.soul)}, change = ctx.by.node;\n\t\t\t\tif(opt.on.stat && opt.on.stat.first){ (at = Gun.on.at.copy(at)).change = ctx.by.node }\n\t\t\t\tif(opt.raw){ return cb.call(opt.on, at) }\n\t\t\t\tif(opt.once){ this.off() }\n\t\t\t\tif(opt.change){ change = at.change }\n\t\t\t\tif(!opt.empty && Gun.obj.empty(change, Gun._.meta)){ return }\n\t\t\t\tcb.call(ctx.by.chain || gun, Gun.obj.copy(at.field? change[at.field] : change), at.field || (at.at && at.at.field));\n\t\t\t};\n\t\t\topt.on = gun._.at('soul').map(map);\n\t\t\tif(gun === gun.back){ Gun.log('You have no context to `.on`!') }\n\t\t\treturn gun;\n\t\t}\n\n\t\tGun.chain.path = (function(){\n\t\t\tGun.on('get').event(function(gun, at, ctx, opt, cb, lex){\n\t\t\t\tif(ctx.halt){ return } // TODO: CLEAN UP with event emitter option?\n\t\t\t\tif(opt.path){ at.at = opt.path }\n\t\t\t\tvar xtc = {soul: lex[Gun._.soul], field: lex[Gun._.field]};\n\t\t\t\txtc.change = at.change || gun.__.by(at.soul).node;\n\t\t\t\tif(xtc.field){ // TODO: future feature!\n\t\t\t\t\tif(!Gun.obj.has(xtc.change, xtc.field)){ return }\n\t\t\t\t\tctx.node = Gun.is.node.soul.ify({}, at.soul); // TODO: CLEAN UP! ctx.node usage.\n\t\t\t\t\tGun.is.node.state.ify([ctx.node, xtc.change], xtc.field, xtc.change[xtc.field]);\n\t\t\t\t\tat.change = ctx.node; at.field = xtc.field;\n\t\t\t\t}\n\t\t\t},-99);\n\t\t\tGun.on('get').event(function(gun, at, ctx, opt, cb, lex){\n\t\t\t\tif(ctx.halt){ return } // TODO: CLEAN UP with event emitter option?\n\t\t\t\tvar xtc = {}; xtc.change = at.change || gun.__.by(at.soul).node;\n\t\t\t\tif(!opt.put){ // TODO: CLEAN UP be nice if path didn't have to worry about this.\n\t\t\t\t\tGun.is.node(xtc.change, function(v,f){\n\t\t\t\t\t\tvar fat = Gun.on.at.copy(at); fat.field = f; fat.value = v;\n\t\t\t\t\t\tGun.obj.del(fat, 'at'); // TODO: CLEAN THIS UP! It would be nice in every other function every where else it didn't matter whether there was a cascading at.at.at.at or not, just and only whether the current context as a field or should rely on a previous field. But maybe that is the gotcha right there?\n\t\t\t\t\t\tfat.change = fat.change || xtc.change;\n\t\t\t\t\t\tif(v = Gun.is.rel(fat.value)){ fat = {soul: v, at: fat} }\n\t\t\t\t\t\tgun._.at('path:' + f).emit(fat).chain(opt.chain);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif(!ctx.end){\n\t\t\t\t\tctx.end = gun._.at('end').emit(at).chain(opt.chain);\n\t\t\t\t}\n\t\t\t},99);\n\t\t\treturn function(path, cb, opt){\n\t\t\t\topt = opt || {};\n\t\t\t\tcb = cb || (function(){ var cb = function(){}; cb.no = true; return cb }()); cb.hash = {};\n\t\t\t\tvar gun = this, chain = gun.chain(), f, c, u;\n\t\t\t\tif(!Gun.list.is(path)){ if(!Gun.text.is(path)){ if(!Gun.num.is(path)){ // if not a list, text, or number\n\t\t\t\t\treturn cb.call(chain, {err: Gun.log(\"Invalid path '\" + path + \"'!\")}), chain; // then complain\n\t\t\t\t} else { return this.path(path + '', cb, opt)  } } else { return this.path(path.split('.'), cb, opt) } } // else coerce upward to a list.\n\t\t\t\tif(gun === gun.back){\n\t\t\t\t\tcb.call(chain, opt.put? null : {err: Gun.log('You have no context to `.path`', path, '!')}, opt.put? gun.__.graph[(path||[])[0]] : u);\n\t\t\t\t\treturn chain;\n\t\t\t\t}\n\t\t\t\tgun._.at('path:' + path[0]).event(function(at){\n\t\t\t\t\tif(opt.done){ this.off(); return } // TODO: BUG - THIS IS A FIX FOR A BUG! TEST #\"context no double emit\", COMMENT THIS LINE OUT AND SEE IT FAIL!\n\t\t\t\t\tvar ctx = {soul: at.soul, field: at.field, by: gun.__.by(at.soul)}, field = path[0];\n\t\t\t\t\tvar on = Gun.obj.as(cb.hash, at.hash, {off: function(){}});\n\t\t\t\t\tif(at.soul === on.soul){ return }\n\t\t\t\t\telse { on.off() }\n\t\t\t\t\tif(ctx.rel = (Gun.is.rel(at.value) || Gun.is.rel(at.at && at.at.value))){\n\t\t\t\t\t\tif(opt.put && 1 === path.length){\n\t\t\t\t\t\t\treturn cb.call(ctx.by.chain || chain, null, Gun.is.node.soul.ify({}, ctx.rel));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar get = function(err, node){\n\t\t\t\t\t\t\tif(!err && 1 !== path.length){ return }\n\t\t\t\t\t\t\tcb.call(this, err, node, field);\n\t\t\t\t\t\t};\n\t\t\t\t\t\tctx.opt = {chain: opt.chain || chain, put: opt.put, path: {soul: (at.at && at.at.soul) || at.soul, field: field }};\n\t\t\t\t\t\tgun.__.gun.get(ctx.rel || at.soul, cb.no? null : get, ctx.opt);\n\t\t\t\t\t\t(opt.on = cb.hash[at.hash] = on = ctx.opt.on).soul = at.soul; // TODO: BUG! CB getting reused as the hash point for multiple paths potentially! Could cause problems!\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tif(1 === path.length){ cb.call(ctx.by.chain || chain, null, at.value, ctx.field) }\n\t\t\t\t\tchain._.at('soul').emit(at).chain(opt.chain);\n\t\t\t\t});\n\t\t\t\tgun._.at('null').only(function(at){\n\t\t\t\t\tif(!at.field){ return }\n\t\t\t\t\tif(at.not){ \n\t\t\t\t\t\tgun.put({}, null, {init: true});\n\t\t\t\t\t\tif(opt.init || gun.__.opt.init){ return }\n\t\t\t\t\t}\n\t\t\t\t\t(at = Gun.on.at.copy(at)).field = path[0];\n\t\t\t\t\tat.not = true;\n\t\t\t\t\tchain._.at('null').emit(at).chain(opt.chain);\n\t\t\t\t});\n\t\t\t\tgun._.at('end').event(function(at){\n\t\t\t\t\tthis.off();\n\t\t\t\t\tif(at.at && at.at.field === path[0]){ return } // TODO: BUG! THIS FIXES SO MANY PROBLEMS BUT DOES IT CATCH VARYING SOULS EDGE CASE?\n\t\t\t\t\tvar ctx = {by: gun.__.by(at.soul)};\n\t\t\t\t\tif(Gun.obj.has(ctx.by.node, path[0])){ return }\n\t\t\t\t\t(at = Gun.on.at.copy(at)).field = path[0];\n\t\t\t\t\tat.not = true;\n\t\t\t\t\tcb.call(ctx.by.chain || chain, null);\n\t\t\t\t\tchain._.at('null').emit(at).chain(opt.chain);\n\t\t\t\t});\n\t\t\t\tif(path.length > 1){\n\t\t\t\t\t(c = chain.path(path.slice(1), cb, opt)).back = gun;\n\t\t\t\t}\n\t\t\t\treturn c || chain;\n\t\t\t}\n\t\t}());\n\n\t\tGun.chain.map = function(cb, opt){\n\t\t\tvar u, gun = this, chain = gun.chain();\n\t\t\tcb = cb || function(){}; cb.hash = {};\n\t\t\topt = Gun.bi.is(opt)? {change: opt} : opt || {};\n\t\t\topt.change = Gun.bi.is(opt.change)? opt.change : true;\n\t\t\tfunction path(err, val, field){\n\t\t\t\tif(err || (val === u)){ return }\n\t\t\t\tcb.call(this, val, field);\n\t\t\t}\n\t\t\tfunction each(val, field){\n\t\t\t\t//if(!Gun.is.rel(val)){ path.call(this.gun, null, val, field);return;}\n\t\t\t\tif(opt.node){\n\t\t\t\t\tif(!Gun.is.rel(val)){\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcb.hash[this.soul + field] = cb.hash[this.soul + field] || this.gun.path(field, path, {chain: chain, via: 'map'}); // TODO: path should reuse itself! We shouldn't have to do it ourselves.\n\t\t\t\t// TODO:\n\t\t\t\t// 1. Ability to turn off an event. // automatically happens within path since reusing is manual?\n\t\t\t\t// 2. Ability to pass chain context to fire on. // DONE\n\t\t\t\t// 3. Pseudoness handled for us. // DONE\n\t\t\t\t// 4. Reuse. // MANUALLY DONE\n\t\t\t}\n\t\t\tfunction map(at){\n\t\t\t\tvar ref = gun.__.by(at.soul).chain || gun;\n\t\t\t\tGun.is.node(at.change, each, {gun: ref, soul: at.soul});\n\t\t\t}\n\t\t\tgun.on(map, {raw: true, change: true}); // TODO: ALLOW USER TO DO map change false!\n\t\t\tif(gun === gun.back){ Gun.log('You have no context to `.map`!') }\n\t\t\treturn chain;\n\t\t}\n\n\t\tGun.chain.val = (function(){\n\t\t\tGun.on('get.wire').event(function(gun, ctx){\n\t\t\t\tif(!ctx.soul){ return } var end;\n\t\t\t\t(end = gun.__.by(ctx.soul)).end = (end.end || -1); // TODO: CLEAN UP! This should be per peer!\n\t\t\t},-999);\n\t\t\tGun.on('wire.get').event(function(gun, ctx, err, data){\n\t\t\t\tif(err || !ctx.soul){ return }\n\t\t\t\tif(data && !Gun.obj.empty(data, Gun._.meta)){ return }\n\t\t\t\tvar end = gun.__.by(ctx.soul);\n\t\t\t\tend.end = (!end.end || end.end < 0)? 1 : end.end + 1;\n\t\t\t},-999);\n\t\t\treturn function(cb, opt){\n\t\t\t\tvar gun = this, args = Gun.list.slit.call(arguments);\n\t\t\t\tcb = Gun.fns.is(cb)? cb : function(val, field){ root.console.log.apply(root.console, args.concat([field && (field += ':'), val])) }; cb.hash = {};\n\t\t\t\topt = opt || {};\n\t\t\t\tfunction val(at){\n\t\t\t\t\tvar ctx = {by: gun.__.by(at.soul), at: at.at || at}, node = ctx.by.node, field = ctx.at.field, hash = Gun.on.at.hash({soul: ctx.at.key || ctx.at.soul, field: field});\n\t\t\t\t\tif(cb.hash[hash]){ return }\n\t\t\t\t\tif(at.field && Gun.obj.has(node, at.field)){\n\t\t\t\t\t\treturn cb.hash[hash] = true, cb.call(ctx.by.chain || gun, Gun.obj.copy(node[at.field]), at.field);\n\t\t\t\t\t}\n\t\t\t\t\tif(!opt.empty && Gun.obj.empty(node, Gun._.meta)){ return } // TODO: CLEAN UP! .on already does this without the .raw!\n\t\t\t\t\tif(ctx.by.end < 0){ return }\n\t\t\t\t\treturn cb.hash[hash] = true, cb.call(ctx.by.chain || gun, Gun.obj.copy(node), field);\n\t\t\t\t}\n\t\t\t\tgun.on(val, {raw: true});\n\t\t\t\tif(gun === gun.back){ Gun.log('You have no context to `.val`!') }\n\t\t\t\treturn gun;\n\t\t\t}\n\t\t}());\n\t\t\n\t\tGun.chain.not = function(cb, opt){\n\t\t\tvar gun = this, chain = gun.chain();\n\t\t\tcb = cb || function(){};\n\t\t\topt = opt || {};\n\t\t\tfunction not(at,e){\n\t\t\t\tif(at.field){\n\t\t\t\t\tif(Gun.obj.has(gun.__.by(at.soul).node, at.field)){ return Gun.obj.del(at, 'not'), chain._.at(e).emit(at) }\n\t\t\t\t} else\n\t\t\t\tif(at.soul && gun.__.by(at.soul).node){ return Gun.obj.del(at, 'not'), chain._.at(e).emit(at) }\n\t\t\t\tif(!at.not){ return }\n\t\t\t\tvar kick = function(next){\n\t\t\t\t\tif(++kick.c){ return Gun.log(\"Warning! Multiple `not` resumes!\"); }\n\t\t\t\t\tnext._.at.all(function(on ,e){ // TODO: BUG? Switch back to .at? I think .on is actually correct so it doesn't memorize. // TODO: BUG! What about other events?\n\t\t\t\t\t\tchain._.at(e).emit(on); \n\t\t\t\t\t});\n\t\t\t\t};\n\t\t\t\tkick.c = -1\n\t\t\t\tkick.chain = gun.chain();\n\t\t\t\tkick.next = cb.call(kick.chain, opt.raw? at : (at.field || at.soul || at.not), kick);\n\t\t\t\tkick.soul = Gun.text.random();\n\t\t\t\tif(Gun.is(kick.next)){ kick(kick.next) }\n\t\t\t\tkick.chain._.at('soul').emit({soul: kick.soul, field: at.field, not: true, via: 'not'});\n\t\t\t}\n\t\t\tgun._.at.all(not);\n\t\t\tif(gun === gun.back){ Gun.log('You have no context to `.not`!') }\n\t\t\tchain._.not = true; // TODO: CLEAN UP! Would be ideal if we could accomplish this in a more elegant way.\n\t\t\treturn chain;\n\t\t}\n\n\t\tGun.chain.set = function(item, cb, opt){\n\t\t\tvar gun = this, ctx = {}, chain;\n\t\t\tcb = cb || function(){};\n\t\t\tif(!Gun.is(item)){ return cb.call(gun, {err: Gun.log('Set only supports node references currently!')}), gun } // TODO: Bug? Should we return not gun on error?\n\t\t\t(ctx.chain = item.chain()).back = gun;\n\t\t\tctx.chain._ = item._;\n\t\t\titem.val(function(node){ // TODO: BUG! Return proxy chain with back = list.\n\t\t\t\tif(ctx.done){ return } ctx.done = true;\n\t\t\t\tvar put = {}, soul = Gun.is.node.soul(node);\n\t\t\t\tif(!soul){ return cb.call(gun, {err: Gun.log('Only a node can be linked! Not \"' + node + '\"!')}) }\n\t\t\t\tgun.put(Gun.obj.put(put, soul, Gun.is.rel.ify(soul)), cb, opt);\n\t\t\t});\n\t\t\treturn ctx.chain;\n\t\t}\n\n\t\tGun.chain.init = function(cb, opt){\n\t\t\tvar gun = this;\n\t\t\tgun._.at('null').event(function(at){\n\t\t\t\tif(!at.not){ return } // TODO: BUG! This check is synchronous but it could be asynchronous!\n\t\t\t\tvar ctx = {by: gun.__.by(at.soul)};\n\t\t\t\tthis.off();\n\t\t\t\tif(at.field){\n\t\t\t\t\tif(Gun.obj.has(ctx.by.node, at.field)){ return }\n\t\t\t\t\tgun._.at('soul').emit({soul: at.soul, field: at.field, not: true});\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(at.soul){\n\t\t\t\t\tif(ctx.by.node){ return }\n\t\t\t\t\tvar soul = Gun.text.random();\n\t\t\t\t\tgun.__.gun.put(Gun.is.node.soul.ify({}, soul), null, {init: true});\n\t\t\t\t\tgun.__.gun.key(at.soul, null, soul);\n\t\t\t\t}\n\t\t\t}, {raw: true});\n\t\t\treturn gun;\n\t\t}\n\n\t}(Gun));\n\n\t;(function(Gun){ // Javascript to Gun Serializer.\n\t\tfunction ify(data, cb, opt){\n\t\t\topt = opt || {};\n\t\t\tcb = cb || function(env, cb){ cb(env.at, Gun.is.node.soul(env.at.obj) || Gun.is.node.soul(env.at.node) || Gun.text.random()) };\n\t\t\tvar end = function(fn){\n\t\t\t\tctx.end = fn || function(){};\n\t\t\t\tunique(ctx);\n\t\t\t}, ctx = {at: {path: [], obj: data}, root: {}, graph: {}, queue: [], seen: [], opt: opt, loop: true};\n\t\t\tif(!data){ return ctx.err = {err: Gun.log('Serializer does not have correct parameters.')}, end }\n\t\t\tif(ctx.opt.start){ Gun.is.node.soul.ify(ctx.root, ctx.opt.start) }\n\t\t\tctx.at.node = ctx.root;\n\t\t\twhile(ctx.loop && !ctx.err){\n\t\t\t\tseen(ctx, ctx.at);\n\t\t\t\tmap(ctx, cb);\n\t\t\t\tif(ctx.queue.length){\n\t\t\t\t\tctx.at = ctx.queue.shift();\n\t\t\t\t} else {\n\t\t\t\t\tctx.loop = false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn end;\n\t\t}\n\t\tfunction map(ctx, cb){\n\t\t\tvar u, rel = function(at, soul){\n\t\t\t\tat.soul = at.soul || soul || Gun.is.node.soul(at.obj) || Gun.is.node.soul(at.node);\n\t\t\t\tif(!ctx.opt.pure){\n\t\t\t\t\tctx.graph[at.soul] = Gun.is.node.soul.ify(at.node, at.soul);\n\t\t\t\t\tif(ctx.at.field){\n\t\t\t\t\t\tGun.is.node.state.ify([at.node], at.field, u, ctx.opt.state);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tGun.list.map(at.back, function(rel){\n\t\t\t\t\trel[Gun._.soul] = at.soul;\n\t\t\t\t});\n\t\t\t\tunique(ctx);\n\t\t\t}, it;\n\t\t\tGun.obj.map(ctx.at.obj, function(val, field){\n\t\t\t\tctx.at.val = val;\n\t\t\t\tctx.at.field = field;\n\t\t\t\tit = cb(ctx, rel, map) || true;\n\t\t\t\tif(field === Gun._.meta){\n\t\t\t\t\tctx.at.node[field] = Gun.obj.copy(val); // TODO: BUG! Is this correct?\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(String(field).indexOf('.') != -1 || (false && notValidField(field))){ // TODO: BUG! Do later for ACID \"consistency\" guarantee.\n\t\t\t\t\treturn ctx.err = {err: Gun.log(\"Invalid field name on '\" + ctx.at.path.join('.') + \"'!\")};\n\t\t\t\t}\n\t\t\t\tif(!Gun.is.val(val)){\n\t\t\t\t\tvar at = {obj: val, node: {}, back: [], path: [field]}, tmp = {}, was;\n\t\t\t\t\tat.path = (ctx.at.path||[]).concat(at.path || []);\n\t\t\t\t\tif(!Gun.obj.is(val)){\n\t\t\t\t\t\treturn ctx.err = {err: Gun.log(\"Invalid value at '\" + at.path.join('.') + \"'!\" )};\n\t\t\t\t\t}\n\t\t\t\t\tif(was = seen(ctx, at)){\n\t\t\t\t\t\ttmp[Gun._.soul] = Gun.is.node.soul(was.node) || null;\n\t\t\t\t\t\t(was.back = was.back || []).push(ctx.at.node[field] = tmp);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tctx.queue.push(at);\n\t\t\t\t\t\ttmp[Gun._.soul] = null;\n\t\t\t\t\t\tat.back.push(ctx.at.node[field] = tmp);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tctx.at.node[field] = Gun.obj.copy(val);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif(!it){ cb(ctx, rel) }\n\t\t}\n\t\tfunction unique(ctx){\n\t\t\tif(ctx.err || (!Gun.list.map(ctx.seen, function(at){\n\t\t\t\tif(!at.soul){ return true }\n\t\t\t}) && !ctx.loop)){ return ctx.end(ctx.err, ctx), ctx.end = function(){}; }\n\t\t}\n\t\tfunction seen(ctx, at){\n\t\t\treturn Gun.list.map(ctx.seen, function(has){\n\t\t\t\tif(at.obj === has.obj){ return has }\n\t\t\t}) || (ctx.seen.push(at) && false);\n\t\t}\n\t\tify.wire = function(n, cb, opt){ return Gun.text.is(n)? ify.wire.from(n, cb, opt) : ify.wire.to(n, cb, opt) }\n\t\tify.wire.to = function(n, cb, opt){ var t, b;\n\t\t\tif(!n || !(t = Gun.is.node.soul(n))){ return null }\n\t\t\tcb = cb || function(){};\n\t\t\tt = (b = \"#'\" + JSON.stringify(t) + \"'\");\n\t\t\tGun.obj.map(n, function(v,f){\n\t\t\t\tif(Gun._.meta === f){ return }\n\t\t\t\tvar w = '', s = Gun.is.node.state(n,f);\n\t\t\t\tif(!s){ return }\n\t\t\t\tw += \".'\" + JSON.stringify(f) + \"'\";\n\t\t\t\tw += \"='\" + JSON.stringify(v) + \"'\";\n\t\t\t\tw += \">'\" + JSON.stringify(s) + \"'\";\n\t\t\t\tt += w;\n\t\t\t\tw = b + w;\n\t\t\t\tcb(null, w);\n\t\t\t});\n\t\t\treturn t;\n\t\t}\n\t\tify.wire.from = function(n, cb, opt){\n\t\t\tif(!n){ return null }\n\t\t\tvar a = [], s = -1, e = 0, end = 1;\n\t\t\twhile((e = n.indexOf(\"'\", s + 1)) >= 0){\n\t\t\t\tif(s === e || '\\\\' === n.charAt(e-1)){}else{\n\t\t\t\t\ta.push(n.slice(s + 1,e));\n\t\t\t\t\ts = e;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn a;\n\t\t}\n\t\tGun.ify = ify;\n\t}(Gun));\n\n\tvar root = this || {}; // safe for window, global, root, and 'use strict'.\n\tif(typeof window !== \"undefined\"){ (root = window).Gun = Gun }\n\tif(typeof module !== \"undefined\" && module.exports){ module.exports = Gun }\n\tif(typeof global !== \"undefined\"){ root = global; }\n\troot.console = root.console || {log: function(s){ return s }}; // safe for old browsers\n\tvar console = {\n\t\tlog: function(s){return root.console.log.apply(root.console, arguments), s},\n\t\tLog: Gun.log = function(s){ return (!Gun.log.squelch && root.console.log.apply(root.console, arguments)), s }\n\t};\n\tconsole.debug = function(i, s){ return (Gun.log.debug && i === Gun.log.debug && Gun.log.debug++) && root.console.log.apply(root.console, arguments), s };\n\tGun.log.count = function(s){ return Gun.log.count[s] = Gun.log.count[s] || 0, Gun.log.count[s]++ }\n}.bind(this || module)());\n\n\n;(function(Tab){\n\n\tif(typeof window === \"undefined\"){ return; }\n\tif(!window.Gun){ return }\n\tif(!window.JSON){ throw new Error(\"Include JSON first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js\") } // for old IE use\n\n\t;(function(exports){\n\t\tfunction s(){}\n\t\ts.put = function(key, val, cb){ try{ store.setItem(key, Gun.text.ify(val)) }catch(e){if(cb)cb(e)} }\n\t\ts.get = function(key, cb){ /*setTimeout(function(){*/ try{ cb(null, Gun.obj.ify(store.getItem(key) || null)) }catch(e){cb(e)} /*},1)*/} \n\t\ts.del = function(key){ return store.removeItem(key) }\n\t\t// Feature detect + local reference\n\t\tvar storage;\n\t\tvar fail;\n\t\tvar uid;\n\t\ttry {\n\t\t\tuid = new Date;\n\t\t\t(storage = window.localStorage).setItem(uid, uid);\n\t\t\tfail = storage.getItem(uid) != uid;\n\t\t\tstorage.removeItem(uid);\n\t\t\tfail && (storage = false);\n\t\t} catch (exception) {}\n\t\tvar store = (storage && window.localStorage) || {setItem: function(){}, removeItem: function(){}, getItem: function(){}};\n\t\texports.store = s;\n\t}.bind(this || module)(Tab));\n\n\tGun.on('opt').event(function(gun, opt){\n\t\topt = opt || {};\n\t\tvar tab = gun.tab = gun.tab || {};\n\t\ttab.store = tab.store || Tab.store;\n\t\ttab.request = tab.request || Gun.request;\n\t\tif(!tab.request){ throw new Error(\"Default GUN driver could not find default network abstraction.\") }\n\t\ttab.request.s = tab.request.s || {};\n\t\ttab.headers = opt.headers || {};\n\t\ttab.headers['gun-sid'] = tab.headers['gun-sid'] || Gun.text.random(); // stream id\n\t\ttab.prefix = tab.prefix || opt.prefix || 'gun/';\n\t\ttab.get = tab.get || function(lex, cb, opt){\n\t\t\tif(!lex){ return }\n\t\t\tvar soul = lex[Gun._.soul];\n\t\t\tif(!soul){ return }\n\t\t\tcb = cb || function(){};\n\t\t\tvar ropt = {};\n\t\t\t(ropt.headers = Gun.obj.copy(tab.headers)).id = tab.msg();\n\t\t\t(function local(soul, cb){\n\t\t\t\ttab.store.get(tab.prefix + soul, function(err, data){\n\t\t\t\t\tif(!data){ return } // let the peers handle no data.\n\t\t\t\t\tif(err){ return cb(err) }\n\t\t\t\t\tcb(err, cb.node = data); // node\n\t\t\t\t\tcb(err, Gun.is.node.soul.ify({}, Gun.is.node.soul(data))); // end\n\t\t\t\t\tcb(err, {}); // terminate\n\t\t\t\t});\n\t\t\t}(soul, cb));\n\t\t\tif(!(cb.local = opt.local)){\n\t\t\t\ttab.request.s[ropt.headers.id] = tab.error(cb, \"Error: Get failed!\", function(reply){\n\t\t\t\t\tsetTimeout(function(){ tab.put(Gun.is.graph.ify(reply.body), function(){}, {local: true, peers: {}}) },1); // and flush the in memory nodes of this graph to localStorage after we've had a chance to union on it.\n\t\t\t\t});\n\t\t\t\tGun.obj.map(opt.peers || gun.__.opt.peers, function(peer, url){ var p = {};\n\t\t\t\t\ttab.request(url, lex, tab.request.s[ropt.headers.id], ropt);\n\t\t\t\t\tcb.peers = true;\n\t\t\t\t});\n\t\t\t\tvar node = gun.__.graph[soul];\n\t\t\t\tif(node){\n\t\t\t\t\ttab.put(Gun.is.graph.ify(node));\n\t\t\t\t}\n\t\t\t} tab.peers(cb);\n\t\t}\n\t\ttab.put = tab.put || function(graph, cb, opt){\n\t\t\tcb = cb || function(){};\n\t\t\topt = opt || {};\n\t\t\tvar ropt = {};\n\t\t\t(ropt.headers = Gun.obj.copy(tab.headers)).id = tab.msg();\n\t\t\tGun.is.graph(graph, function(node, soul){\n\t\t\t\tif(!gun.__.graph[soul]){ return }\n\t\t\t\ttab.store.put(tab.prefix + soul, gun.__.graph[soul], function(err){if(err){ cb({err: err}) }});\n\t\t\t});\n\t\t\tif(!(cb.local = opt.local)){\n\t\t\t\ttab.request.s[ropt.headers.id] = tab.error(cb, \"Error: Put failed!\");\n\t\t\t\tGun.obj.map(opt.peers || gun.__.opt.peers, function(peer, url){\n\t\t\t\t\ttab.request(url, graph, tab.request.s[ropt.headers.id], ropt);\n\t\t\t\t\tcb.peers = true;\n\t\t\t\t});\n\t\t\t} tab.peers(cb);\n\t\t}\n\t\ttab.error = function(cb, error, fn){\n\t\t\treturn function(err, reply){\n\t\t\t\treply.body = reply.body || reply.chunk || reply.end || reply.write;\n\t\t\t\tif(err || !reply || (err = reply.body && reply.body.err)){\n\t\t\t\t\treturn cb({err: Gun.log(err || error) });\n\t\t\t\t}\n\t\t\t\tif(fn){ fn(reply) }\n\t\t\t\tcb(null, reply.body);\n\t\t\t}\n\t\t}\n\t\ttab.peers = function(cb, o){\n\t\t\tif(Gun.text.is(cb)){ return (o = {})[cb] = {}, o }\n\t\t\tif(cb && !cb.peers){ setTimeout(function(){\n\t\t\t\tif(!cb.local){ if(!Gun.log.count('no-peers')){ Gun.log(\"Warning! You have no peers to connect to!\") } }\n\t\t\t\tif(!(cb.graph || cb.node)){ cb(null) }\n\t\t\t},1)}\n\t\t}\n\t\ttab.msg = tab.msg || function(id){\n\t\t\tif(!id){\n\t\t\t\treturn tab.msg.debounce[id = Gun.text.random(9)] = Gun.time.is(), id;\n\t\t\t}\n\t\t\tclearTimeout(tab.msg.clear);\n\t\t\ttab.msg.clear = setTimeout(function(){\n\t\t\t\tvar now = Gun.time.is();\n\t\t\t\tGun.obj.map(tab.msg.debounce, function(t,id){\n\t\t\t\t\tif(now - t < 1000 * 60 * 5){ return }\n\t\t\t\t\tGun.obj.del(tab.msg.debounce, id);\n\t\t\t\t});\n\t\t\t},500);\n\t\t\tif(id = tab.msg.debounce[id]){ \n\t\t\t\treturn tab.msg.debounce[id] = Gun.time.is(), id;\n\t\t\t}\n\t\t};\n\t\ttab.msg.debounce = tab.msg.debounce || {};\n\t\ttab.server = tab.server || function(req, res){\n\t\t\tif(!req || !res || !req.body || !req.headers || !req.headers.id){ return }\n\t\t\tif(tab.request.s[req.headers.rid]){ return tab.request.s[req.headers.rid](null, req) }\n\t\t\tif(tab.msg(req.headers.id)){ return }\n\t\t\t// TODO: Re-emit message to other peers if we have any non-overlaping ones.\n\t\t\tif(req.headers.rid){ return } // no need to process\n\t\t\tif(Gun.is.lex(req.body)){ return tab.server.get(req, res) }\n\t\t\telse { return tab.server.put(req, res) }\n\t\t}\n\t\ttab.server.json = 'application/json';\n\t\ttab.server.regex = gun.__.opt.route = gun.__.opt.route || opt.route || /^\\/gun/i;\n\t\ttab.server.get = function(req, cb){\n\t\t\tvar soul = req.body[Gun._.soul], node;\n\t\t\tif(!(node = gun.__.graph[soul])){ return }\n\t\t\tvar reply = {headers: {'Content-Type': tab.server.json, rid: req.headers.id, id: tab.msg()}};\n\t\t\tcb({headers: reply.headers, body: node});\n\t\t}\n\t\ttab.server.put = function(req, cb){\n\t\t\tvar reply = {headers: {'Content-Type': tab.server.json, rid: req.headers.id, id: tab.msg()}}, keep;\n\t\t\tif(!req.body){ return cb({headers: reply.headers, body: {err: \"No body\"}}) }\n\t\t\tif(!Gun.obj.is(req.body, function(node, soul){\n\t\t\t\tif(gun.__.graph[soul]){ return true }\n\t\t\t})){ return }\n\t\t\tif(req.err = Gun.union(gun, req.body, function(err, ctx){\n\t\t\t\tif(err){ return cb({headers: reply.headers, body: {err: err || \"Union failed.\"}}) }\n\t\t\t\tvar ctx = ctx || {}; ctx.graph = {};\n\t\t\t\tGun.is.graph(req.body, function(node, soul){ ctx.graph[soul] = gun.__.graph[soul] });\n\t\t\t\tgun.__.opt.wire.put(ctx.graph, function(err, ok){\n\t\t\t\t\tif(err){ return cb({headers: reply.headers, body: {err: err || \"Failed.\"}}) }\n\t\t\t\t\tcb({headers: reply.headers, body: {ok: ok || \"Persisted.\"}});\n\t\t\t\t}, {local: true, peers: {}});\n\t\t\t}).err){ cb({headers: reply.headers, body: {err: req.err || \"Union failed.\"}}) }\n\t\t}\n\t\tGun.obj.map(gun.__.opt.peers, function(){ // only create server if peers and do it once by returning immediately.\n\t\t\treturn (tab.server.able = tab.server.able || tab.request.createServer(tab.server) || true);\n\t\t});\n\t\tgun.__.opt.wire.get = gun.__.opt.wire.get || tab.get;\n\t\tgun.__.opt.wire.put = gun.__.opt.wire.put || tab.put;\n\t\tgun.__.opt.wire.key = gun.__.opt.wire.key || tab.key;\n\n\t\tTab.request = tab.request;\n\t\tGun.Tab = Tab;\n\t});\n\n}.bind(this || module)({}));\n\n\n;(function(Tab){\n\tvar request = (function(){\n\t\tfunction r(base, body, cb, opt){ opt = opt || {};\n\t\t\tvar o = base.length? {base: base} : {};\n\t\t\to.base = opt.base || base;\n\t\t\to.body = opt.body || body;\n\t\t\to.headers = opt.headers;\n\t\t\to.url = opt.url;\n\t\t\tcb = cb || function(){};\n\t\t\tif(!o.base){ return }\n\t\t\tr.transport(o, cb);\n\t\t}\n\t\tr.createServer = function(fn){ r.createServer.s.push(fn) }\n\t\tr.createServer.ing = function(req, cb){\n\t\t\tvar i = r.createServer.s.length;\n\t\t\twhile(i--){ (r.createServer.s[i] || function(){})(req, cb) }\n\t\t}\n\t\tr.createServer.s = [];\n\t\tr.back = 2; r.backoff = 2;\n\t\tr.transport = function(opt, cb){\n\t\t\t//Gun.log(\"TRANSPORT:\", opt);\n\t\t\tif(r.ws(opt, cb)){ return }\n\t\t\tr.jsonp(opt, cb);\n\t\t}\n\t\tr.ws = function(opt, cb){\n\t\t\tvar ws, WS = r.WebSocket || window.WebSocket || window.mozWebSocket || window.webkitWebSocket;\n\t\t\tif(!WS){ return }\n\t\t\tif(ws = r.ws.peers[opt.base]){\n\t\t\t\tif(!ws.readyState){ return setTimeout(function(){ r.ws(opt, cb) },10), true }\n\t\t\t\tvar req = {};\n\t\t\t\tif(opt.headers){ req.headers = opt.headers }\n\t\t\t\tif(opt.body){ req.body = opt.body }\n\t\t\t\tif(opt.url){ req.url = opt.url }\n\t\t\t\treq.headers = req.headers || {};\n\t\t\t\tr.ws.cbs[req.headers['ws-rid'] = 'WS' + (+ new Date()) + '.' + Math.floor((Math.random()*65535)+1)] = function(err,res){\n\t\t\t\t\tif(res.body || res.end){ delete r.ws.cbs[req.headers['ws-rid']] }\n\t\t\t\t\tcb(err,res);\n\t\t\t\t}\n\t\t\t\tws.send(JSON.stringify(req),function(err){})\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif(ws === false){ return }\n\t\t\ttry{ws = r.ws.peers[opt.base] = new WS(opt.base.replace('http','ws'));\n\t\t\t}catch(e){}\n\t\t\tws.onopen = function(o){ r.back = 2; r.ws(opt, cb) };\n\t\t\tws.onclose = function(c){\n\t\t\t\tif(!c){ return }\n\t\t\t\tif(ws && ws.close instanceof Function){ ws.close() }\n\t\t\t\tif(1006 === c.code){ // websockets cannot be used\n\t\t\t\t\t/*ws = r.ws.peers[opt.base] = false; // 1006 has mixed meanings, therefore we can no longer respect it.\n\t\t\t\t\tr.transport(opt, cb);\n\t\t\t\t\treturn;*/\n\t\t\t\t}\n\t\t\t\tws = r.ws.peers[opt.base] = null; // this will make the next request try to reconnect\n\t\t\t\tsetTimeout(function(){\n\t\t\t\t\tr.ws(opt, function(){}); // opt here is a race condition, is it not? Does this matter?\n\t\t\t\t}, r.back *= r.backoff);\n\t\t\t};\n\t\t\tif(typeof window !== \"undefined\"){ window.onbeforeunload = ws.onclose; }\n\t\t\tws.onmessage = function(m){\n\t\t\t\tif(!m || !m.data){ return }\n\t\t\t\tvar res;\n\t\t\t\ttry{res = JSON.parse(m.data);\n\t\t\t\t}catch(e){ return }\n\t\t\t\tif(!res){ return }\n\t\t\t\tres.headers = res.headers || {};\n\t\t\t\tif(res.headers['ws-rid']){ return (r.ws.cbs[res.headers['ws-rid']]||function(){})(null, res) }\n\t\t\t\tif(res.body){ r.createServer.ing(res, function(res){ r(opt.base, null, null, res)}) } // emit extra events.\n\t\t\t};\n\t\t\tws.onerror = function(e){ console.log(e); };\n\t\t\treturn true;\n\t\t}\n\t\tr.ws.peers = {};\n\t\tr.ws.cbs = {};\n\t\tr.jsonp = function(opt, cb){\n\t\t\tif(typeof window === \"undefined\"){\n\t\t\t\treturn cb(\"JSONP is currently browser only.\");\n\t\t\t}\n\t\t\t//Gun.log(\"jsonp send\", opt);\n\t\t\tr.jsonp.ify(opt, function(url){\n\t\t\t\t//Gun.log(url);\n\t\t\t\tif(!url){ return }\n\t\t\t\tr.jsonp.send(url, function(reply){\n\t\t\t\t\t//Gun.log(\"jsonp reply\", reply);\n\t\t\t\t\tcb(null, reply);\n\t\t\t\t\tr.jsonp.poll(opt, reply);\n\t\t\t\t}, opt.jsonp);\n\t\t\t});\n\t\t}\n\t\tr.jsonp.send = function(url, cb, id){\n\t\t\tvar js = document.createElement('script');\n\t\t\tjs.src = url;\n\t\t\twindow[js.id = id] = function(res){\n\t\t\t\tcb(res);\n\t\t\t\tcb.id = js.id;\n\t\t\t\tjs.parentNode.removeChild(js);\n\t\t\t\twindow[cb.id] = null; // TODO: BUG: This needs to handle chunking!\n\t\t\t\ttry{delete window[cb.id];\n\t\t\t\t}catch(e){}\n\t\t\t}\n\t\t\tjs.async = true;\n\t\t\tdocument.getElementsByTagName('head')[0].appendChild(js);\n\t\t\treturn js;\n\t\t}\n\t\tr.jsonp.poll = function(opt, res){\n\t\t\tif(!opt || !opt.base || !res || !res.headers || !res.headers.poll){ return }\n\t\t\t(r.jsonp.poll.s = r.jsonp.poll.s || {})[opt.base] = r.jsonp.poll.s[opt.base] || setTimeout(function(){ // TODO: Need to optimize for Chrome's 6 req limit?\n\t\t\t\t//Gun.log(\"polling again\");\n\t\t\t\tvar o = {base: opt.base, headers: {pull: 1}};\n\t\t\t\tr.each(opt.headers, function(v,i){ o.headers[i] = v })\n\t\t\t\tr.jsonp(o, function(err, reply){\n\t\t\t\t\tdelete r.jsonp.poll.s[opt.base];\n\t\t\t\t\twhile(reply.body && reply.body.length && reply.body.shift){ // we're assuming an array rather than chunk encoding. :(\n\t\t\t\t\t\tvar res = reply.body.shift();\n\t\t\t\t\t\t//Gun.log(\"-- go go go\", res);\n\t\t\t\t\t\tif(res && res.body){ r.createServer.ing(res, function(){ r(opt.base, null, null, res) }) } // emit extra events.\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}, res.headers.poll);\n\t\t}\n\t\tr.jsonp.ify = function(opt, cb){\n\t\t\tvar uri = encodeURIComponent, q = '?';\n\t\t\tif(opt.url && opt.url.pathname){ q = opt.url.pathname + q; }\n\t\t\tq = opt.base + q;\n\t\t\tr.each((opt.url||{}).query, function(v, i){ q += uri(i) + '=' + uri(v) + '&' });\n\t\t\tif(opt.headers){ q += uri('`') + '=' + uri(JSON.stringify(opt.headers)) + '&' }\n\t\t\tif(r.jsonp.max < q.length){ return cb() }\n\t\t\tq += uri('jsonp') + '=' + uri(opt.jsonp = 'P'+Math.floor((Math.random()*65535)+1));\n\t\t\tif(opt.body){\n\t\t\t\tq += '&';\n\t\t\t\tvar w = opt.body, wls = function(w,l,s){\n\t\t\t\t\treturn uri('%') + '=' + uri(w+'-'+(l||w)+'/'+(s||w))  + '&' + uri('$') + '=';\n\t\t\t\t}\n\t\t\t\tif(typeof w != 'string'){\n\t\t\t\t\tw = JSON.stringify(w);\n\t\t\t\t\tq += uri('^') + '=' + uri('json') + '&';\n\t\t\t\t}\n\t\t\t\tw = uri(w);\n\t\t\t\tvar i = 0, l = w.length\n\t\t\t\t, s = r.jsonp.max - (q.length + wls(l.toString()).length);\n\t\t\t\tif(s < 0){ return cb() }\n\t\t\t\twhile(w){\n\t\t\t\t\tcb(q + wls(i, (i = i + s), l) + w.slice(0, i));\n\t\t\t\t\tw = w.slice(i);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tcb(q);\n\t\t\t}\n\t\t}\n\t\tr.jsonp.max = 2000;\n\t\tr.each = function(obj, cb){\n\t\t\tif(!obj || !cb){ return }\n\t\t\tfor(var i in obj){\n\t\t\t\tif(obj.hasOwnProperty(i)){\n\t\t\t\t\tcb(obj[i], i);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t}());\n\tif(typeof window !== \"undefined\"){ Gun.request = request }\n\tif(typeof module !== \"undefined\" && module.exports){ module.exports.request = request }\n}.bind(this || module)({}));\n\n}).call(this,typeof global !== \"undefined\" ? global : typeof self !== \"undefined\" ? self : typeof window !== \"undefined\" ? window : {})\n},{}],2:[function(require,module,exports){\n'use strict';\n\nvar _gun = require('gun/gun');\n\nvar _gun2 = _interopRequireDefault(_gun);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n//const gun = Gun(['http://localhost:8080/gun']);\n//const gun = Gun(['http://localhost:8080/gun','https://gundb-louis.herokuapp.com/gun']);\nvar gun = (0, _gun2.default)(['https://gundb-louis.herokuapp.com/gun']);\n\nvar textInput = document.getElementById('myInput');\n\nvar ref = gun.get('text').not(function (key) {\n  // put in an object and key it\n  gun.put({\n    text: ''\n  }).key(key);\n});\nref.on(function (data) {\n  textInput.value = data.text;\n  document.body.style.backgroundColor = data.text;\n});\n\nwindow.updateMyInput = function () {\n  ref.path('text').put(textInput.value);\n};\n\n},{\"gun/gun\":1}]},{},[2]);\n"]}